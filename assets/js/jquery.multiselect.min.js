!function($){var defaults={columns:1,search:!1,searchOptions:{delay:250,showOptGroups:!1,searchText:!0,searchValue:!1,onSearch:function(element){}},texts:{placeholder:"Select options",search:"Search",selectedOptions:" selected",selectAll:"Select all",unselectAll:"Unselect all",noneSelected:"None Selected"},selectAll:!1,selectGroup:!1,minHeight:200,maxHeight:null,maxWidth:null,maxPlaceholderWidth:null,maxPlaceholderOpts:10,showCheckbox:!0,checkboxAutoFit:!1,optionAttributes:[],onLoad:function(element){},onOptionClick:function(element,option){},onControlClose:function(element){},onSelectAll:function(element,selected){},onPlaceholder:function(element,placeholder,selectedOpts){}},msCounter=1,msOptCounter=1;function MultiSelect(element,options){if(this.element=element,this.options=$.extend(!0,{},defaults,options),this.updateSelectAll=!0,this.updatePlaceholder=!0,this.listNumber=msCounter,msCounter+=1,!$(this.element).attr("multiple"))throw new Error("[jQuery-MultiSelect] Select list must be a multiselect list in order to use this plugin");if(this.options.search&&!this.options.searchOptions.searchText&&!this.options.searchOptions.searchValue)throw new Error("[jQuery-MultiSelect] Either searchText or searchValue should be true.");"placeholder"in this.options&&(this.options.texts.placeholder=this.options.placeholder,delete this.options.placeholder),"default"in this.options.searchOptions&&(this.options.texts.search=this.options.searchOptions.default,delete this.options.searchOptions.default),this.load()}"function"!=typeof Array.prototype.map&&(Array.prototype.map=function(callback,thisArg){return void 0===thisArg&&(thisArg=this),$.isArray(thisArg)?$.map(thisArg,callback):[]}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),MultiSelect.prototype={load:function(){var instance=this;if("SELECT"!=instance.element.nodeName||$(instance.element).hasClass("jqmsLoaded"))return!0;$(instance.element).addClass("jqmsLoaded ms-list-"+instance.listNumber).data("plugin_multiselect-instance",instance),$(instance.element).after('<div id="ms-list-'+instance.listNumber+'" class="ms-options-wrap"><button type="button"><span>None Selected</span></button><div class="ms-options"><ul></ul></div></div>');var placeholder=$(instance.element).siblings("#ms-list-"+instance.listNumber+".ms-options-wrap").find("> button:first-child"),optionsWrap=$(instance.element).siblings("#ms-list-"+instance.listNumber+".ms-options-wrap").find("> .ms-options"),optionsList=optionsWrap.find("> ul");if(instance.options.showCheckbox?instance.options.checkboxAutoFit&&optionsWrap.addClass("checkbox-autofit"):optionsWrap.addClass("hide-checkbox"),$(instance.element).prop("disabled")&&placeholder.prop("disabled",!0),instance.options.maxPlaceholderWidth&&placeholder.css("maxWidth",instance.options.maxPlaceholderWidth),instance.options.maxHeight)var maxHeight=instance.options.maxHeight;else var maxHeight=$(window).height()-optionsWrap.offset().top+$(window).scrollTop()-20;if(maxHeight=maxHeight<instance.options.minHeight?instance.options.minHeight:maxHeight,optionsWrap.css({maxWidth:instance.options.maxWidth,minHeight:instance.options.minHeight,maxHeight:maxHeight}),optionsWrap.on("touchmove mousewheel DOMMouseScroll",(function(e){if($(this).outerHeight()<$(this)[0].scrollHeight){var e0=e.originalEvent,delta=e0.wheelDelta||-e0.detail;$(this).outerHeight()+$(this)[0].scrollTop>$(this)[0].scrollHeight&&(e.preventDefault(),this.scrollTop+=delta<0?1:-1)}})),$(document).off("click.ms-hideopts").on("click.ms-hideopts",(function(event){$(event.target).closest(".ms-options-wrap").length||$(".ms-options-wrap.ms-active > .ms-options").each((function(){$(this).closest(".ms-options-wrap").removeClass("ms-active");var listID=$(this).closest(".ms-options-wrap").attr("id"),thisInst=$(this).parent().siblings("."+listID+".jqmsLoaded").data("plugin_multiselect-instance");"function"==typeof thisInst.options.onControlClose&&thisInst.options.onControlClose(thisInst.element)}))})).on("keydown",(function(event){27==(event.keyCode||event.which)&&$(this).trigger("click.ms-hideopts")})),placeholder.on("keydown",(function(event){var code=event.keyCode||event.which;13!=code&&32!=code||placeholder.trigger("mousedown")})),placeholder.on("mousedown",(function(event){if(event.which&&1!=event.which)return!0;if($(".ms-options-wrap.ms-active").each((function(){if($(this).siblings("."+$(this).attr("id")+".jqmsLoaded")[0]!=optionsWrap.parent().siblings(".ms-list-"+instance.listNumber+".jqmsLoaded")[0]){$(this).removeClass("ms-active");var thisInst=$(this).siblings("."+$(this).attr("id")+".jqmsLoaded").data("plugin_multiselect-instance");"function"==typeof thisInst.options.onControlClose&&thisInst.options.onControlClose(thisInst.element)}})),optionsWrap.closest(".ms-options-wrap").toggleClass("ms-active"),optionsWrap.closest(".ms-options-wrap").hasClass("ms-active")){if(optionsWrap.css("maxHeight",""),instance.options.maxHeight)var maxHeight=instance.options.maxHeight;else var maxHeight=$(window).height()-optionsWrap.offset().top+$(window).scrollTop()-20;maxHeight&&(maxHeight=maxHeight<instance.options.minHeight?instance.options.minHeight:maxHeight,optionsWrap.css("maxHeight",maxHeight))}else"function"==typeof instance.options.onControlClose&&instance.options.onControlClose(instance.element)})).click((function(event){event.preventDefault()})),instance.options.texts.placeholder&&placeholder.find("span").text(instance.options.texts.placeholder),instance.options.search){optionsList.before('<div class="ms-search"><input type="text" value="" placeholder="'+instance.options.texts.search+'" /></div>');var search=optionsWrap.find(".ms-search input");search.on("keyup",(function(){if($(this).data("lastsearch")==$(this).val())return!0;$(this).data("searchTimeout")&&clearTimeout($(this).data("searchTimeout"));var thisSearchElem=$(this);$(this).data("searchTimeout",setTimeout((function(){thisSearchElem.data("lastsearch",thisSearchElem.val()),"function"==typeof instance.options.searchOptions.onSearch&&instance.options.searchOptions.onSearch(instance.element);var searchString=$.trim(search.val().toLowerCase());searchString?(optionsList.find('li[data-search-term*="'+searchString+'"]:not(.optgroup)').removeClass("ms-hidden"),optionsList.find('li:not([data-search-term*="'+searchString+'"], .optgroup)').addClass("ms-hidden")):optionsList.find(".ms-hidden").removeClass("ms-hidden"),instance.options.searchOptions.showOptGroups||optionsList.find(".optgroup").each((function(){$(this).find("li:not(.ms-hidden)").length?$(this).show():$(this).hide()})),instance._updateSelectAllText()}),instance.options.searchOptions.delay))}))}instance.options.selectAll&&optionsList.before('<a href="#" class="ms-selectall global">'+instance.options.texts.selectAll+"</a>"),optionsWrap.on("click",".ms-selectall",(function(event){event.preventDefault(),instance.updateSelectAll=!1,instance.updatePlaceholder=!1;var select=optionsWrap.parent().siblings(".ms-list-"+instance.listNumber+".jqmsLoaded");if($(this).hasClass("global"))optionsList.find("li:not(.optgroup, .selected, .ms-hidden)").length?(optionsList.find("li:not(.optgroup, .selected, .ms-hidden)").addClass("selected"),optionsList.find('li.selected input[type="checkbox"]:not(:disabled)').prop("checked",!0)):(optionsList.find("li:not(.optgroup, .ms-hidden).selected").removeClass("selected"),optionsList.find('li:not(.optgroup, .ms-hidden, .selected) input[type="checkbox"]:not(:disabled)').prop("checked",!1));else if($(this).closest("li").hasClass("optgroup")){var optgroup=$(this).closest("li.optgroup");optgroup.find("li:not(.selected, .ms-hidden)").length?(optgroup.find("li:not(.selected, .ms-hidden)").addClass("selected"),optgroup.find('li.selected input[type="checkbox"]:not(:disabled)').prop("checked",!0)):(optgroup.find("li:not(.ms-hidden).selected").removeClass("selected"),optgroup.find('li:not(.ms-hidden, .selected) input[type="checkbox"]:not(:disabled)').prop("checked",!1))}var vals=[];optionsList.find('li.selected input[type="checkbox"]').each((function(){vals.push($(this).val())})),select.val(vals).trigger("change"),instance.updateSelectAll=!0,instance.updatePlaceholder=!0,"function"==typeof instance.options.onSelectAll&&instance.options.onSelectAll(instance.element,vals.length),instance._updateSelectAllText(),instance._updatePlaceholderText()}));var options=[];$(instance.element).children().each((function(){if("OPTGROUP"==this.nodeName){var groupOptions=[];$(this).children("option").each((function(){for(var thisOptionAtts={},i=0;i<instance.options.optionAttributes.length;i++){var thisOptAttr=instance.options.optionAttributes[i];void 0!==$(this).attr(thisOptAttr)&&(thisOptionAtts[thisOptAttr]=$(this).attr(thisOptAttr))}groupOptions.push({name:$(this).text(),value:$(this).val(),checked:$(this).prop("selected"),attributes:thisOptionAtts})})),options.push({label:$(this).attr("label"),options:groupOptions})}else{if("OPTION"!=this.nodeName)return!0;for(var thisOptionAtts={},i=0;i<instance.options.optionAttributes.length;i++){var thisOptAttr=instance.options.optionAttributes[i];void 0!==$(this).attr(thisOptAttr)&&(thisOptionAtts[thisOptAttr]=$(this).attr(thisOptAttr))}options.push({name:$(this).text(),value:$(this).val(),checked:$(this).prop("selected"),attributes:thisOptionAtts})}})),instance.loadOptions(options,!0,!1),optionsWrap.on("click",'input[type="checkbox"]',(function(){var select;$(this).closest("li").toggleClass("selected"),optionsWrap.parent().siblings(".ms-list-"+instance.listNumber+".jqmsLoaded").find('option[value="'+instance._escapeSelector($(this).val())+'"]').prop("selected",$(this).is(":checked")).closest("select").trigger("change"),"function"==typeof instance.options.onOptionClick&&instance.options.onOptionClick(instance.element,this),instance._updateSelectAllText(),instance._updatePlaceholderText()})),optionsWrap.on("focusin",'input[type="checkbox"]',(function(){$(this).closest("label").addClass("focused")})).on("focusout",'input[type="checkbox"]',(function(){$(this).closest("label").removeClass("focused")})),"function"==typeof instance.options.onLoad&&instance.options.onLoad(instance.element),$(instance.element).hide()},loadOptions:function(options,overwrite,updateSelect){overwrite="boolean"!=typeof overwrite||overwrite,updateSelect="boolean"!=typeof updateSelect||updateSelect;var instance=this,select=$(this.element),optionsList=select.siblings("#ms-list-"+this.listNumber+".ms-options-wrap").find("> .ms-options > ul"),optionsWrap=select.siblings("#ms-list-"+this.listNumber+".ms-options-wrap").find("> .ms-options");overwrite&&(optionsList.find("> li").remove(),updateSelect&&select.find("> *").remove());var containers=[];for(var key in options)if(options.hasOwnProperty(key)){var thisOption=options[key],container=$("<li/>"),appendContainer=!0;if(thisOption.hasOwnProperty("value")){if(this.options.showCheckbox&&this.options.checkboxAutoFit&&container.addClass("ms-reflow"),this._addOption(container,thisOption),updateSelect){var selOption=$("<option/>",{value:thisOption.value,text:thisOption.name});thisOption.hasOwnProperty("attributes")&&Object.keys(thisOption.attributes).length&&selOption.attr(thisOption.attributes),thisOption.checked&&selOption.prop("selected",!0),select.append(selOption)}}else{if(!thisOption.hasOwnProperty("options"))continue;var optGroup=$("<optgroup/>",{label:thisOption.label});for(var gKey in optionsList.find("> li.optgroup > span.label").each((function(){$(this).text()==thisOption.label&&(container=$(this).closest(".optgroup"),appendContainer=!1)})),updateSelect&&(select.find('optgroup[label="'+thisOption.label+'"]').length?optGroup=select.find('optgroup[label="'+thisOption.label+'"]'):select.append(optGroup)),appendContainer&&(container.addClass("optgroup"),container.append('<span class="label">'+thisOption.label+"</span>"),container.find("> .label").css({clear:"both"}),this.options.selectGroup&&container.append('<a href="#" class="ms-selectall">'+this.options.texts.selectAll+"</a>"),container.append("<ul/>")),thisOption.options)if(thisOption.options.hasOwnProperty(gKey)){var thisGOption=thisOption.options[gKey],gContainer=$("<li/>");if(this.options.showCheckbox&&this.options.checkboxAutoFit&&gContainer.addClass("ms-reflow"),thisGOption.hasOwnProperty("value")&&(this._addOption(gContainer,thisGOption),container.find("> ul").append(gContainer),updateSelect)){var selOption=$("<option/>",{value:thisGOption.value,text:thisGOption.name});thisGOption.hasOwnProperty("attributes")&&Object.keys(thisGOption.attributes).length&&selOption.attr(thisGOption.attributes),thisGOption.checked&&selOption.prop("selected",!0),optGroup.append(selOption)}}}appendContainer&&containers.push(container)}if(optionsList.append(containers),this.options.checkboxAutoFit&&this.options.showCheckbox&&!optionsWrap.hasClass("hide-checkbox")){var chkbx=optionsList.find('.ms-reflow:eq(0) input[type="checkbox"]');if(chkbx.length){var checkboxWidth=chkbx.outerWidth();checkboxWidth=checkboxWidth||15,optionsList.find(".ms-reflow label").css("padding-left",2*parseInt(chkbx.closest("label").css("padding-left"))+checkboxWidth),optionsList.find(".ms-reflow").removeClass("ms-reflow")}}this._updatePlaceholderText(),optionsWrap.find("ul").css({"column-count":"","column-gap":"","-webkit-column-count":"","-webkit-column-gap":"","-moz-column-count":"","-moz-column-gap":""}),select.find("optgroup").length?(optionsList.find("> li:not(.optgroup)").css({float:"left",width:100/this.options.columns+"%"}),optionsList.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":this.options.columns,"column-gap":0,"-webkit-column-count":this.options.columns,"-webkit-column-gap":0,"-moz-column-count":this.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&optionsList.find("li.optgroup > ul > li").css({float:"left",width:100/this.options.columns+"%"})):(optionsList.css({"column-count":this.options.columns,"column-gap":0,"-webkit-column-count":this.options.columns,"-webkit-column-gap":0,"-moz-column-count":this.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&optionsList.find("> li").css({float:"left",width:100/this.options.columns+"%"})),this._updateSelectAllText()},settings:function(options){this.options=$.extend(!0,{},this.options,options),this.reload()},unload:function(){$(this.element).siblings("#ms-list-"+this.listNumber+".ms-options-wrap").remove(),$(this.element).show((function(){$(this).css("display","").removeClass("jqmsLoaded")}))},reload:function(){$(this.element).siblings("#ms-list-"+this.listNumber+".ms-options-wrap").remove(),$(this.element).removeClass("jqmsLoaded"),this.load()},reset:function(){var defaultVals=[];$(this.element).find("option").each((function(){$(this).prop("defaultSelected")&&defaultVals.push($(this).val())})),$(this.element).val(defaultVals),this.reload()},disable:function(status){status="boolean"!=typeof status||status,$(this.element).prop("disabled",status),$(this.element).siblings("#ms-list-"+this.listNumber+".ms-options-wrap").find("button:first-child").prop("disabled",status)},_updateSelectAllText:function(){if(this.updateSelectAll){var instance=this,optionsWrap;if(instance.options.selectAll||instance.options.selectGroup)$(instance.element).siblings("#ms-list-"+instance.listNumber+".ms-options-wrap").find("> .ms-options").find(".ms-selectall").each((function(){var unselected=$(this).parent().find("li:not(.optgroup,.selected,.ms-hidden)");$(this).text(unselected.length?instance.options.texts.selectAll:instance.options.texts.unselectAll)}))}},_updatePlaceholderText:function(){if(this.updatePlaceholder){var instance=this,select=$(this.element),selectVals=select.val()?select.val():[],placeholder=select.siblings("#ms-list-"+this.listNumber+".ms-options-wrap").find("> button:first-child"),placeholderTxt=placeholder.find("span"),optionsWrap=select.siblings("#ms-list-"+this.listNumber+".ms-options-wrap").find("> .ms-options");select.find("option:selected:disabled").length&&(selectVals=[],select.find("option:selected").each((function(){selectVals.push($(this).val())})));var selOpts=[];for(var key in selectVals)if(selectVals.hasOwnProperty(key)&&(selOpts.push($.trim(select.find('option[value="'+this._escapeSelector(selectVals[key])+'"]').text())),selOpts.length>=this.options.maxPlaceholderOpts))break;placeholderTxt.text(selOpts.join(", ")),selOpts.length?(optionsWrap.closest(".ms-options-wrap").addClass("ms-has-selections"),"function"==typeof this.options.onPlaceholder&&this.options.onPlaceholder(this.element,placeholderTxt,selOpts)):optionsWrap.closest(".ms-options-wrap").removeClass("ms-has-selections"),selOpts.length?(placeholderTxt.width()>placeholder.width()||selOpts.length!=selectVals.length)&&placeholderTxt.text(selectVals.length+this.options.texts.selectedOptions):placeholderTxt.text(this.options.texts.placeholder)}},_addOption:function(container,option){var instance=this,optionNameText=$("<div/>").html(option.name).text(),thisOption=$("<label/>",{for:"ms-opt-"+msOptCounter}).html(option.name),thisCheckbox=$("<input>",{type:"checkbox",title:optionNameText,id:"ms-opt-"+msOptCounter,value:option.value});option.hasOwnProperty("attributes")&&Object.keys(option.attributes).length&&thisCheckbox.attr(option.attributes),option.checked&&(container.addClass("default selected"),thisCheckbox.prop("checked",!0)),thisOption.prepend(thisCheckbox);var searchTerm="";this.options.searchOptions.searchText&&(searchTerm+=" "+optionNameText.toLowerCase()),this.options.searchOptions.searchValue&&(searchTerm+=" "+option.value.toLowerCase()),container.attr("data-search-term",$.trim(searchTerm)).prepend(thisOption),msOptCounter+=1},_ieVersion:function(){var myNav=navigator.userAgent.toLowerCase();return-1!=myNav.indexOf("msie")&&parseInt(myNav.split("msie")[1])},_escapeSelector:function(string){return"function"==typeof $.escapeSelector?$.escapeSelector(string):string.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&")}},$.fn.multiselect=function(options){if(this.length){var args=arguments,ret;return void 0===options||"object"==typeof options?this.each((function(){$.data(this,"plugin_multiselect")||$.data(this,"plugin_multiselect",new MultiSelect(this,options))})):"string"==typeof options&&"_"!==options[0]&&"init"!==options?(this.each((function(){var instance=$.data(this,"plugin_multiselect");instance instanceof MultiSelect&&"function"==typeof instance[options]&&(ret=instance[options].apply(instance,Array.prototype.slice.call(args,1))),"unload"===options&&$.data(this,"plugin_multiselect",null)})),ret):void 0}}}(jQuery);